<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>BINGO</title>
  <style>
/* 
ØªÙˆØ¬Ù‡: ÙØ±Ø¶ Ø´Ø¯Ù‡ ÙÙˆÙ†Øª 'b titr' Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ú©Ø§Ø±Ø¨Ø± Ù†ØµØ¨ Ø§Ø³Øª. 
Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù„ÛŒÙ†Ú© Ø®Ø§Ø±Ø¬ÛŒ ÛŒØ§ @font-face Ú©Ø§Ù…Ù„ Ø¨ÙˆØ¯ØŒ Ø¨Ø§ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯.
*/
body {
background-color: #4e0101;
color: #fff;
font-family: 'b titr', Tahoma, sans-serif;
display: flex;
justify-content: center;
align-items: center;
height: 100vh;
margin: 0;
flex-direction: column;
overflow-y: auto; 
}

#menu {
display: flex;
flex-direction: column;
align-items: center;
gap: 15px;
}

button {
width: 120px;
height: 45px;
background-color: #000;
color: #fff;
border: 2px solid #78cf31;
border-radius: 10px;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
cursor: pointer;
transition: 0.3s;
}

button:hover {
background-color: #78cf31;
color: #000;
}

#countdown {
font-size: 50px;
font-weight: bold;
margin-bottom: 20px;
display: none;
}

#gameArea {
display: none;
flex-direction: column;
align-items: center;
gap: 25px;
}

#buttonGrid {
grid-template-columns: repeat(3, 120px); /* ØªØºÛŒÛŒØ± Ø¨Ù‡ 3 Ø³ØªÙˆÙ† */
grid-template-rows: repeat(3, 45px); /* 9 Ø¯Ú©Ù…Ù‡ Ø¯Ø± 3 Ø³Ø·Ø± Ùˆ 3 Ø³ØªÙˆÙ† */
display: grid;
gap: 15px;
justify-content: center;
align-content: center;
}

#randomBox {
width: 150px;
height: 150px;
border: 4px solid #78cf31;
border-radius: 15px;
display: flex;
justify-content: center;
align-items: center;
font-size: 48px;
color: #78cf31;
font-family: 'b titr', Tahoma, sans-serif;
display: none;
}

.selected {
background-color: #78cf31;
color: #000;
}

#cancelBtn {
width: 130px;
height: 45px;
background-color: #a10000;
color: #fff;
border: 2px solid #fff;
border-radius: 10px;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
cursor: pointer;
margin-top: 15px;
}

#cancelBtn:hover {
background-color: #ff4444;
color: #000;
}

/* ------------------------------ Modal Styles ------------------------------ */

#settingsPage, #walletPage, #shopPage, #adminPage, #contactPage {
display: none;
flex-direction: column;
align-items: center;
max-width: 90%;
min-width: 350px;
text-align: center;
gap: 15px;
background-color: rgba(0,0,0,0.4);
border-radius: 15px;
padding: 20px;
max-height: 90vh;
overflow-y: auto;
}

/* ğŸ“ ØµÙØ­Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª - Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ */
#contactPage {
border: 2px solid #fff; 
}
#contactPage .contact-link {
width: 250px;
height: 45px;
background-color: #000;
color: #fff;
border: 2px solid #78cf31;
border-radius: 10px;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
cursor: pointer;
transition: 0.3s;
display: flex;
justify-content: center;
align-items: center;
text-decoration: none; /* Ø¨Ø±Ø§ÛŒ Ù„ÛŒÙ†Ú© Ù‡Ø§ */
}
#contactPage .contact-link:hover {
background-color: #78cf31;
color: #000;
}


/* âœ… Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª (Ø«Ø§Ø¨Øª) */
.copy-card-btn {
  width: 250px;
  background-color: #4e0101; /* Ø±Ù†Ú¯ ØªÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ ØµØ§Ø­Ø¨ Ø¨Ø§Ø²ÛŒ */
  color: #fff;
  border: 2px solid #ffdb99; /* Ø®Ø· Ù…Ø±Ø²ÛŒ Ø·Ù„Ø§ÛŒÛŒ */
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
  transition: 0.3s;
  margin-top: 10px;
}
.copy-card-btn:hover {
  background-color: #ffdb99;
  color: #4e0101;
}
.card-owner {
  display: block;
  color: #ffdb99;
  margin-top: 5px;
  font-size: 15px;
}

/* Toast Ù¾ÛŒØ§Ù… ØªØ£ÛŒÛŒØ¯ */
.toast {
  visibility: hidden;
  min-width: 200px;
  background-color: rgba(78, 1, 1, 0.9); /* Ø±Ù†Ú¯ Ø²Ù…ÛŒÙ†Ù‡ ØªÛŒØ±Ù‡ Ø¨Ø§ Ø´ÙØ§ÙÛŒØª */
  color: #fff;
  text-align: center;
  padding: 12px;
  border-radius: 8px;
  position: fixed;
  left: 50%;
  bottom: 30px;
  transform: translateX(-50%);
  z-index: 1000;
  transition: visibility 0s, opacity 0.4s ease;
  opacity: 0;
  font-family: 'b titr', Tahoma, sans-serif;
}
.toast.show {
  visibility: visible;
  opacity: 1;
}


/* âš™ï¸ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
#settingsPage {
border: 2px solid #78cf31;
}
#settingsPage input {
width: 90%;
height: 35px;
border: 2px solid #78cf31;
border-radius: 10px;
text-align: center;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
outline: none;
color: #000;
}

#settingsInfo {
font-size: 13px;
color: #ffdb99;
direction: rtl;
text-align: justify;
}

#saveSettings {
width: 100px;
height: 40px;
background-color: #007a00;
border: 2px solid #78cf31;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#saveSettings:hover {
background-color: #78cf31;
color: #000;
}

/* ğŸ’° ØµÙØ­Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ */
#walletPage {
border: 2px solid #ffdb99;
}
#balanceBox {
width: 250px;
height: 60px;
border: 2px dashed #ffdb99;
border-radius: 10px;
display: flex;
justify-content: center;
align-items: center;
font-size: 20px;
color: #ffdb99;
margin-bottom: 10px;
}

#walletPage input {
width: 90%;
height: 35px;
border: 2px solid #ffdb99;
border-radius: 10px;
text-align: center;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
outline: none;
color: #000;
margin-top: 10px;
}

#sellPrice {
font-size: 14px;
color: #78cf31;
}

#totalRialsDisplay {
font-size: 18px;
color: #fff;
font-weight: bold;
}

#sellBtn {
width: 100px;
height: 40px;
background-color: #a10000;
border: 2px solid #fff;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#sellBtn:hover {
background-color: #ff4444;
color: #000;
}

#backBtn, #walletBackBtn, #shopBackBtn, #adminBackBtn, #contactBackBtn {
width: 100px;
height: 40px;
background-color: #950000;
border: 2px solid #fff;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#backBtn:hover, #walletBackBtn:hover, #shopBackBtn:hover, #adminBackBtn:hover, #contactBackBtn:hover {
background-color: #ff4444;
color: #000;
}

/* ğŸ›ï¸ ØµÙØ­Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ */
#shopPage {
border: 2px solid #78cf31;
color: #fff;
}

#shopPage input {
border: 2px solid #78cf31;
}

#buyPrice {
font-size: 14px;
color: #78cf31;
}

#totalBuyPriceDisplay {
font-size: 18px;
font-weight: bold;
color: #fff;
}

#buyBtn {
width: 100px;
height: 40px;
background-color: #007a00;
border: 2px solid #78cf31;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#buyBtn:hover {
background-color: #78cf31;
color: #000;
}

/* ğŸ‘‘ ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª - Ø¬Ø¯ÙˆÙ„ Ú¯Ø²Ø§Ø±Ø´Ø§Øª */
#adminPage {
border: 2px solid #fff;
}

#adminPassword {
width: 90%;
height: 35px;
border: 2px solid #fff; 
border-radius: 10px;
text-align: center;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
outline: none;
color: #000;
margin-top: 10px;
}

#adminLoginBtn {
width: 100px;
height: 40px;
background-color: #007a00;
border: 2px solid #78cf31;
border-radius: 10px;
color: #fff;
cursor: pointer;
margin-top: 15px;
}

#reportArea {
width: 100%;
margin-top: 20px;
direction: rtl;
overflow-x: auto;
}

#reportArea h4 {
color: #ffdb99;
margin-bottom: 10px;
}

.report-table {
width: 100%;
border-collapse: collapse;
min-width: 800px;
font-size: 14px;
}

.report-table th, .report-table td {
border: 1px solid #78cf31;
padding: 8px;
text-align: right;
vertical-align: middle;
}

.report-table th {
background-color: rgba(120, 207, 49, 0.2);
color: #fff;
}

.report-table td button {
width: 100px;
height: 35px;
font-size: 13px;
transition: none;
}

/* Ø¯Ú©Ù…Ù‡ ØªØ³ÙˆÛŒÙ‡ (Sell Report) */
.settle-btn {
background-color: #a10000; 
border: 1px solid #fff;
}
.settled {
background-color: #007a00;
border: 1px solid #78cf31;
cursor: default;
}

/* Ø¯Ú©Ù…Ù‡ Ø±ÙˆÛŒØª Ø´Ø¯ (Buy Report) */
.review-btn {
background-color: #ffdb99; 
color: #000;
border: 1px solid #000;
}
.reviewed {
background-color: #007a00;
border: 1px solid #78cf31;
color: #fff;
cursor: default;
}
  </style>
</head>

<body>
  <!-- ğŸ® Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
  <div id="menu">
    <button id="startBtn">ğŸ® Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
    <button id="settings">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
    <button id="wallet">ğŸ’° Ú©ÛŒÙ Ù¾ÙˆÙ„</button>
    <button id="shopBtn">ğŸ›ï¸ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</button>
    <button id="contactBtn">ğŸ“ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª</button> 
    <button id="admin">ğŸ‘‘ Ù…Ø¯ÛŒØ±ÛŒØª</button>
  </div>

  <div id="countdown"></div>

  <!-- ğŸ² Ø¨Ø§Ø²ÛŒ -->
  <div id="gameArea">
    <div id="buttonGrid"></div>
    <div id="randomBox"></div>
    <button id="cancelBtn">âŒ Ø§Ù†ØµØ±Ø§Ù</button>
  </div>

  <!-- âš™ï¸ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
  <div id="settingsPage">
    <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ø±Ø¨Ø± ğŸ’¾</h3>
    <input type="text" id="fullname" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" />
    <p id="settingsInfo">
      âš ï¸ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ú©Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ù‚Ø³Ù…Øª ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ Ø´Ù…Ø§ Ù‡Ù…Ø®ÙˆØ§Ù†ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.
      Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø¬Ù‡Øª ÙˆØ§Ø±ÛŒØ² Ù‡Ø¯ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø³Øª Ùˆ Ø¯Ø±ØµÙˆØ±Øª Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§ØªØŒ Ø§Ø¯Ù…ÛŒÙ† Ù…Ø³Ø¦ÙˆÙ„ÛŒØªÛŒ Ø¯Ø± Ù‚Ø¨Ø§Ù„ Ø®Ø·Ø§ÛŒ Ø´Ù…Ø§ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø¯Ø§Ø´Øª.
    </p>
    <input type="text" id="cardNumber" maxlength="16" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª 16 Ø±Ù‚Ù…ÛŒ" />
    <button id="saveSettings">ØªØ£ÛŒÛŒØ¯ âœ…</button>
    <button id="backBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>
  
  <!-- ğŸ’° ØµÙØ­Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ -->
  <div id="walletPage">
    <h3>Ú©ÛŒÙ Ù¾ÙˆÙ„ ğŸ’°</h3>
    <div id="balanceBox">
      Ù…ÙˆØ¬ÙˆØ¯ÛŒ: <span id="currentBalance">10</span> Ø³Ú©Ù‡
    </div>
    <input type="number" id="sellAmount" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´" min="1" />
    <p id="sellPrice">Ù‚ÛŒÙ…Øª Ù‡Ø± 1 Ø³Ú©Ù‡: 1000 ØªÙˆÙ…Ø§Ù†</p>
    <span id="totalRialsDisplay"></span>
    <button id="sellBtn">ÙØ±ÙˆØ´ ğŸ’¸</button>
    <button id="walletBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>

  <!-- ğŸ›ï¸ ØµÙØ­Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
  <div id="shopPage">
    <h3>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ğŸ›ï¸</h3>
    <input type="number" id="buyAmount" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯" min="1" />
    <p id="buyPrice">Ù‚ÛŒÙ…Øª Ù‡Ø± 1 Ø³Ú©Ù‡: 1200 ØªÙˆÙ…Ø§Ù†</p>
    <span id="totalBuyPriceDisplay"></span>
    <button id="buyBtn">Ø®Ø±ÛŒØ¯ ğŸ›’</button>
    <button id="shopBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>
  
  <!-- ğŸ‘‘ ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª -->
  <div id="adminPage">
    <h3 id="adminTitle">ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª ğŸ”’</h3>
    <div id="adminLoginForm" style="display: flex; flex-direction: column; align-items: center; width: 100%;">
      <input type="password" id="adminPassword" maxlength="4" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Û´ Ø±Ù‚Ù…ÛŒ" />
      <button id="adminLoginBtn">ÙˆØ±ÙˆØ¯ âœ…</button>
      <p id="adminAuthMessage" style="color: red; font-size: 14px; margin: 5px 0;"></p>
    </div>
    <div id="adminContent" style="display:none; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px; width: 100%;">
      <p style="color: #78cf31; font-size: 18px;">Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ Ø§Ù…ÛŒØ± ğŸ‘‘!</p>
      <button id="buyReportBtn" style="width: 200px; background-color: #007a00; border-color: #78cf31;">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡</button>
      <button id="sellReportBtn" style="width: 200px; background-color: #a10000; border-color: #fff;">ğŸ“‰ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ Ø³Ú©Ù‡</button>
      <div id="reportArea"></div>
    </div>
    <button id="adminBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>

  <!-- ğŸ“ ØµÙØ­Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª (Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ú©Ø§Ø±Øª Ø«Ø§Ø¨Øª) -->
  <div id="contactPage">
    <h3>ğŸ“ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª</h3>
    
    <!-- Ù„ÛŒÙ†Ú© Ù‡Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ Ù‚Ø¨Ù„ÛŒ -->
    <a href="https://rubika.ir/IR_VBOOK" target="_blank" class="contact-link">Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´ Ø³Ú©Ù‡</a>
    <button id="channelContactBtn" class="contact-link" style="text-align: center; display: flex; justify-content: center; align-items: center;">Ú©Ø§Ù†Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹ Ø±Ø³Ø§Ù†ÛŒ</button>

    <!-- âœ… Ù‚Ø§Ø¨Ù„ÛŒØª Ø¬Ø¯ÛŒØ¯: Ú©Ù¾ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø«Ø§Ø¨Øª ØµØ§Ø­Ø¨ Ø¨Ø§Ø²ÛŒ -->
    <div class="contact-section">
      <button id="copyCardBtn" class="copy-card-btn">ğŸ“‹ Ú©Ù¾ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª</button>
      <small class="card-owner">Ø§Ù…ÛŒØ± Ø¯Ø´ØªÛŒ</small>
    </div>
    
    <button id="contactBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>

  <!-- Toast Ù¾ÛŒØ§Ù… ØªØ£ÛŒÛŒØ¯ (Ù…Ø®ÙÛŒ) -->
  <div id="toast" class="toast"></div>


  <script>
// --- CONSTANTS ---
const GAME_COST = 1;
const WIN_REWARD = 10;
const LOSS_PENALTY = 5;
const CANCEL_PENALTY = 2; // Ø¬Ø±ÛŒÙ…Ù‡ Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ Ø§Ø² Ø´Ø±ÙˆØ¹
const SELL_PRICE = 1000;
const BUY_PRICE = 1200; // Ù†Ø±Ø® Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡
const ADMIN_PASS = "1428"; // Ø±Ù…Ø² Ù…Ø¯ÛŒØ±ÛŒØª
const OWNER_CARD_NUMBER = "6219861997529960"; // âœ… Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø«Ø§Ø¨Øª Ø§Ù…ÛŒØ± Ø¯Ø´ØªÛŒ

// Ø¹Ù†Ø§ØµØ± ØµÙØ­Ù‡
const settingsPage = document.getElementById("settingsPage");
const walletPage = document.getElementById("walletPage");
const shopPage = document.getElementById("shopPage");
const adminPage = document.getElementById("adminPage");
const contactPage = document.getElementById("contactPage");
const menu = document.getElementById("menu");
const gameArea = document.getElementById("gameArea");

const currentBalanceSpan = document.getElementById("currentBalance");
const fullnameInput = document.getElementById("fullname");
const cardNumberInput = document.getElementById("cardNumber");
const sellAmountInput = document.getElementById("sellAmount");
const buyAmountInput = document.getElementById("buyAmount");

const buttonGrid = document.getElementById("buttonGrid");
const randomBox = document.getElementById("randomBox");
const countdown = document.getElementById("countdown");

const reportArea = document.getElementById("reportArea");
const buyReportBtn = document.getElementById("buyReportBtn");
const sellReportBtn = document.getElementById("sellReportBtn");

let randomInterval;
let readNumbers = [];
let buttonNumbers = [];
let isGameActive = false;
let isCountdownOver = false;
let clickConfirmTimer = null;
let currentNumberToConfirm = null;
let clickConfirmed = false;

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ø§Øª ---
function hideAllPages() {
  const pages = [settingsPage, walletPage, shopPage, adminPage, contactPage, gameArea, menu];
  pages.forEach(page => page.style.display = "none");
  reportArea.innerHTML = ""; 
}

function showMenu() {
  hideAllPages();
  menu.style.display = "flex";
}

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³Ú©Ù‡ ---
function loadBalance() {
  let balance = localStorage.getItem("userBalance");
  if (balance === null || isNaN(parseInt(balance))) {
    balance = 10;
    localStorage.setItem("userBalance", balance);
  }
  currentBalanceSpan.textContent = parseInt(balance);
  return parseInt(balance);
}

function updateBalance(amount) {
  const current = loadBalance();
  const newBalance = current + amount;
  localStorage.setItem("userBalance", newBalance);
  currentBalanceSpan.textContent = newBalance;
  return newBalance;
}

// Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ
function resetGameToMenu() {
  clearInterval(randomInterval);
  clearTimeout(clickConfirmTimer);

  buttonGrid.innerHTML = "";
  readNumbers = [];
  buttonNumbers = [];
  isGameActive = false;
  isCountdownOver = false;
  currentNumberToConfirm = null;
  clickConfirmed = false;

  gameArea.style.display = "none";
  randomBox.style.display = "none";
  countdown.style.display = "none";
  showMenu();
}

// Ù…Ù†Ø·Ù‚ Ø¨Ø§Ø®Øª Ùˆ Ø¨Ø±Ø¯
function handleWin() {
  updateBalance(WIN_REWARD);
  alert(`ğŸ‰ ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÛŒÙ… Ø§Ù…ÛŒØ±! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯ Ùˆ ${WIN_REWARD} Ø³Ú©Ù‡ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`);
  resetGameToMenu();
}

function handleLoss(message) {
  updateBalance(-LOSS_PENALTY);
  alert(message || `ğŸ˜” Ù…ØªØ£Ø³ÙÛŒÙ… Ø§Ù…ÛŒØ±! Ø´Ù…Ø§ Ø¨Ø§Ø®ØªÛŒØ¯ Ùˆ ${LOSS_PENALTY} Ø³Ú©Ù‡ Ø§Ø² Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ú©Ø³Ø± Ø´Ø¯.`);
  resetGameToMenu();
}

function checkWinCondition() {
  const buttons = buttonGrid.querySelectorAll("button");
  let selectedCount = 0;
  buttons.forEach(btn => {
    if (btn.classList.contains("selected")) {
      selectedCount++;
    }
  });
  // Ø¯Ø± Ø¨Ø§Ø²ÛŒ Û¹ Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ø±ÛŒÙ…
  if (selectedCount === 9) { 
    clearInterval(randomInterval);
    clearTimeout(clickConfirmTimer); 
    handleWin();
    return true;
  }
  return false;
}

// --- Ú¯Ø²Ø§Ø±Ø´Ø§Øª ---

function getCurrentDateTime() {
  const now = new Date();
  const date = now.toLocaleDateString('fa-IR');
  const time = now.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  return `${date} Ø³Ø§Ø¹Øª ${time}`;
}

function loadSellReports() {
  return JSON.parse(localStorage.getItem("sellReports") || "[]");
}

function saveSellReports(reports) {
  localStorage.setItem("sellReports", JSON.stringify(reports));
}

function renderSellReports() {
  const reports = loadSellReports();
  reportArea.innerHTML = '<h4>ğŸ“‰ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ ÙØ±ÙˆØ´ Ø³Ú©Ù‡</h4>';
  // ... (Ú©Ø¯ Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´) ...
  if (reports.length === 0) {
    reportArea.innerHTML += '<p style="color:#ffdb99;">Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
    return;
  }

  let tableHTML = '<table class="report-table"><thead><tr>';
  tableHTML += '<th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th><th>Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª (Ú©Ø§Ù…Ù„)</th><th>Ø³Ú©Ù‡ ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯Ù‡</th><th>Ù…Ø¨Ù„Øº ÙˆØ§Ø±ÛŒØ²ÛŒ (ØªÙˆÙ…Ø§Ù†)</th><th>ØªØ§Ø±ÛŒØ®/Ø³Ø§Ø¹Øª</th><th>ÙˆØ¶Ø¹ÛŒØª</th>';
  tableHTML += '</tr></thead><tbody>';

  reports.forEach((report, index) => {
    const settledClass = report.settled ? 'settled' : 'settle-btn';
    const buttonText = report.settled ? 'âœ”ï¸ ØªØ³ÙˆÛŒÙ‡ Ø´Ø¯' : 'ğŸ’µ ØªØ³ÙˆÛŒÙ‡ Ú©Ù†';
    const disabled = report.settled ? 'disabled' : '';

    tableHTML += `<tr><td>${report.fullName}</td><td>${report.cardNumber}</td><td>${report.coinsSold}</td><td>${report.totalRials.toLocaleString('fa-IR')}</td><td>${report.dateTime}</td><td><button id="settle-${index}" class="${settledClass}" ${disabled}>${buttonText}</button></td></tr>`;
  });
  tableHTML += '</tbody></table>';
  reportArea.innerHTML += tableHTML;

  reports.forEach((report, index) => {
    const btn = document.getElementById(`settle-${index}`);
    if (btn && !report.settled) {
      btn.addEventListener('click', () => handleSettle(index));
    }
  });
}

function handleSettle(index) {
  let reports = loadSellReports();
  if (reports[index] && !reports[index].settled) {
    reports[index].settled = true;
    saveSellReports(reports);
    renderSellReports();
  }
}

function loadBuyReports() {
  return JSON.parse(localStorage.getItem("buyReports") || "[]");
}

function saveBuyReports(reports) {
  localStorage.setItem("buyReports", JSON.stringify(reports));
}

function renderBuyReports() {
  const reports = loadBuyReports();
  reportArea.innerHTML = '<h4>ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡</h4>';
  // ... (Ú©Ø¯ Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯) ...
  if (reports.length === 0) {
    reportArea.innerHTML += '<p style="color:#ffdb99;">Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
    return;
  }

  let tableHTML = '<table class="report-table"><thead><tr>';
  tableHTML += '<th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th><th>ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ø®Ø±ÛŒØ¯Ù‡ Ø´Ø¯Ù‡</th><th>Ù…Ø¨Ù„Øº ÙˆØ§Ø±ÛŒØ²ÛŒ (ØªÙˆÙ…Ø§Ù†)</th><th>ØªØ§Ø±ÛŒØ®/Ø³Ø§Ø¹Øª</th><th>ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª</th>';
  tableHTML += '</tr></thead><tbody>';

  reports.forEach((report, index) => {
    const reviewedClass = report.reviewed ? 'reviewed' : 'review-btn';
    const buttonText = report.reviewed ? 'âœ”ï¸ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯' : 'âœ… Ø±ÙˆÛŒØª Ø´Ø¯';
    const disabled = report.reviewed ? 'disabled' : '';

    tableHTML += `<tr><td>${report.fullName}</td><td>${report.coinsBought}</td><td>${report.totalRials.toLocaleString('fa-IR')}</td><td>${report.dateTime}</td><td><button id="review-${index}" class="${reviewedClass}" ${disabled}>${buttonText}</button></td></tr>`;
  });

  tableHTML += '</tbody></table>';
  reportArea.innerHTML += tableHTML;

  reports.forEach((report, index) => {
    const btn = document.getElementById(`review-${index}`);
    if (btn && !report.reviewed) {
      btn.addEventListener('click', () => handleReview(index));
    }
  });
}

function handleReview(index) {
  let reports = loadBuyReports();
  if (reports[index] && !reports[index].reviewed) {
    reports[index].reviewed = true;
    saveBuyReports(reports);
    renderBuyReports();
  }
}

// --- Toast Function ---
function showToast(message) {
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2500);
}


// --- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ---

// 1. ØªÙ†Ø¸ÛŒÙ…Ø§Øª (Settings)
document.getElementById("settings").addEventListener("click", () => {
  hideAllPages();
  settingsPage.style.display = "flex";
  const savedName = localStorage.getItem("fullname");
  const savedCard = localStorage.getItem("cardNumber");
  if (savedName) fullnameInput.value = savedName;
  if (savedCard) cardNumberInput.value = savedCard;
});
document.getElementById("backBtn").addEventListener("click", showMenu);
document.getElementById("saveSettings").addEventListener("click", () => {
  const name = fullnameInput.value.trim();
  const card = cardNumberInput.value.trim();

  if (!name) { alert("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."); return; }
  if (!card || !/^\d{16}$/.test(card)) { alert("âš ï¸ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø¨Ø§ÛŒØ¯ Û±Û¶ Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯."); return; }

  localStorage.setItem("fullname", name);
  localStorage.setItem("cardNumber", card);
  alert("âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
});

// 2. Ú©ÛŒÙ Ù¾ÙˆÙ„ (Wallet)
document.getElementById("wallet").addEventListener("click", () => {
  hideAllPages();
  walletPage.style.display = "flex";
  loadBalance();
  sellAmountInput.value = "";
  document.getElementById("totalRialsDisplay").textContent = "";
});
document.getElementById("walletBackBtn").addEventListener("click", showMenu);

sellAmountInput.addEventListener("input", () => {
  const sellAmount = parseInt(sellAmountInput.value);
  if (isNaN(sellAmount) || sellAmount <= 0) { document.getElementById("totalRialsDisplay").textContent = ""; return; }
  const totalRials = sellAmount * SELL_PRICE;
  document.getElementById("totalRialsDisplay").textContent = `Ù…Ø¨Ù„Øº Ú©Ù„: ${totalRials.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
});

document.getElementById("sellBtn").addEventListener("click", () => {
  const balance = loadBalance();
  const sellAmount = parseInt(sellAmountInput.value);
  const cardNum = localStorage.getItem("cardNumber");
  const fullName = localStorage.getItem("fullname");

  if (!cardNum || !fullName) { alert("âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ù†Ø§Ù… Ùˆ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù‚Ø³Ù…Øª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯!"); return; }
  if (isNaN(sellAmount) || sellAmount <= 0) { alert("âš ï¸ Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."); return; }
  if (sellAmount > balance) { alert(`â›” Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: ${balance} Ø³Ú©Ù‡.`); return; }

  const totalRials = sellAmount * SELL_PRICE;
  const reports = loadSellReports();
  reports.push({ fullName: fullName, cardNumber: cardNum, coinsSold: sellAmount, totalRials: totalRials, dateTime: getCurrentDateTime(), settled: false });
  saveSellReports(reports);

  updateBalance(-sellAmount);
  sellAmountInput.value = "";
  document.getElementById("totalRialsDisplay").textContent = "";

  alert(`âœ… ${sellAmount} Ø³Ú©Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯. Ù…Ø¨Ù„Øº ${totalRials.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ø§Ø±Øª Ø´Ù…Ø§ ÙˆØ§Ø±ÛŒØ² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`);
});

// 3. ÙØ±ÙˆØ´Ú¯Ø§Ù‡ (Shop)
document.getElementById("shopBtn").addEventListener("click", () => {
  hideAllPages();
  shopPage.style.display = "flex";
  buyAmountInput.value = "";
  document.getElementById("totalBuyPriceDisplay").textContent = "";
});
document.getElementById("shopBackBtn").addEventListener("click", showMenu);

buyAmountInput.addEventListener("input", () => {
  const buyAmount = parseInt(buyAmountInput.value);
  if (isNaN(buyAmount) || buyAmount <= 0) { document.getElementById("totalBuyPriceDisplay").textContent = ""; return; }
  const totalPrice = buyAmount * BUY_PRICE;
  document.getElementById("totalBuyPriceDisplay").textContent = `Ù…Ø¨Ù„Øº Ú©Ù„: ${totalPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
});

document.getElementById("buyBtn").addEventListener("click", () => {
  const buyAmount = parseInt(buyAmountInput.value);
  const fullName = localStorage.getItem("fullname");

  if (!fullName) { alert("âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù‚Ø³Ù…Øª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯!"); return; }
  if (isNaN(buyAmount) || buyAmount <= 0) { alert("âš ï¸ Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."); return; }

  const totalPrice = buyAmount * BUY_PRICE;

  const reports = loadBuyReports();
  reports.push({ fullName: fullName, coinsBought: buyAmount, totalRials: totalPrice, dateTime: getCurrentDateTime(), reviewed: false });
  saveBuyReports(reports);

  updateBalance(buyAmount);
  buyAmountInput.value = "";
  document.getElementById("totalBuyPriceDisplay").textContent = "";

  alert(`âœ… ${buyAmount} Ø³Ú©Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ù„Øº ${totalPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯.`);
});

// 4. Ù…Ø¯ÛŒØ±ÛŒØª (Admin)
document.getElementById("admin").addEventListener("click", () => {
  hideAllPages();
  adminPage.style.display = "flex";
  document.getElementById("adminTitle").textContent = "ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª ğŸ”’";
  document.getElementById("adminPassword").value = '';
  document.getElementById("adminAuthMessage").textContent = '';
  document.getElementById("adminContent").style.display = 'none';
  document.getElementById("adminLoginForm").style.display = 'flex';
  reportArea.innerHTML = "";
});
document.getElementById("adminLoginBtn").addEventListener("click", () => {
  const password = document.getElementById("adminPassword").value;
  if (password === ADMIN_PASS) {
    document.getElementById("adminAuthMessage").textContent = 'Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¬Ø§Ø²';
    document.getElementById("adminAuthMessage").style.color = 'green';
    document.getElementById("adminLoginForm").style.display = 'none';
    document.getElementById("adminContent").style.display = 'flex';
    document.getElementById("adminTitle").textContent = "Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ğŸ‘‘";
  } else {
    document.getElementById("adminAuthMessage").textContent = 'Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ± Ù…Ø¬Ø§Ø²';
    document.getElementById("adminAuthMessage").style.color = 'red';
  }
});
document.getElementById("adminBackBtn").addEventListener("click", showMenu);
buyReportBtn.addEventListener("click", renderBuyReports);
sellReportBtn.addEventListener("click", renderSellReports);

// 5. Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª (Contact)
document.getElementById("contactBtn").addEventListener("click", () => {
  hideAllPages();
  contactPage.style.display = "flex";
});

// âœ… Ù…Ù†Ø·Ù‚ Ú©Ù¾ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø«Ø§Ø¨Øª ØµØ§Ø­Ø¨ Ø¨Ø§Ø²ÛŒ
document.getElementById("copyCardBtn").addEventListener("click", () => {
  navigator.clipboard.writeText(OWNER_CARD_NUMBER).then(() => {
    showToast("âœ… Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ú©Ù¾ÛŒ Ø´Ø¯!");
  });
});

// ğŸš€ Ø§ØµÙ„Ø§Ø­ Ù†Ù‡Ø§ÛŒÛŒ: Ø§Ø±Ø¬Ø§Ø¹ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ù„ÛŒÙ†Ú© Ø±ÙˆØ¨Ù‡â€ŒÚ©Ø§
document.getElementById("channelContactBtn").addEventListener("click", () => {
  window.open("https://rubika.ir/learn_bingo", "_blank");
});

document.getElementById("contactBackBtn").addEventListener("click", showMenu);


// 6. Ø¨Ø§Ø²ÛŒ (Game Logic)
document.getElementById("startBtn").addEventListener("click", () => {
  const currentBalance = loadBalance();
  if (currentBalance < GAME_COST) {
    alert("âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³Ú©Ù‡ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø¨Ù„ÛŒØ· Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Û± Ø³Ú©Ù‡).");
    return;
  }

  updateBalance(-GAME_COST);

  isGameActive = true; 
  isCountdownOver = false;

  hideAllPages();
  countdown.style.display = "block";
  gameArea.style.display = "flex";
  buttonGrid.innerHTML = "";

  // Ø§ÛŒØ¬Ø§Ø¯ 9 Ø¯Ú©Ù…Ù‡
  for (let i = 0; i < 9; i++) {
    const btn = document.createElement("button");
    btn.textContent = "ØŸ";
    btn.disabled = true; 
    buttonGrid.appendChild(btn);
  }

  let timeLeft = 5;
  countdown.textContent = timeLeft;

  const countdownInterval = setInterval(() => {
    timeLeft--;
    countdown.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(countdownInterval);
      countdown.style.display = "none";
      isCountdownOver = true; 
      revealNumbers();
      startRandomBox();
    }
  }, 1000);
});

function revealNumbers() {
  const allNumbers = Array.from({ length: 99 }, (_, i) => i + 1).sort(() => Math.random() - 0.5);
  // 9 Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ø±ÛŒÙ…
  buttonNumbers = allNumbers.slice(0, 9); 

  const buttons = buttonGrid.querySelectorAll("button");
  buttons.forEach((btn, index) => {
    const num = buttonNumbers[index];
    btn.textContent = num;
    btn.dataset.value = num;
    btn.disabled = false;

    const newBtn = btn.cloneNode(true);
    newBtn.addEventListener("click", () => handleButtonClick(newBtn, num));
    btn.replaceWith(newBtn);
  });
  randomBox.style.display = "none"; // Ù†Ù…Ø§ÛŒØ´ Ø±Ù†Ø¯ÙˆÙ… Ø¨Ø§Ú©Ø³ Ø¨Ø§ÛŒØ¯ Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯
}

function startRandomBox() {
  randomBox.style.display = "flex";
  readNumbers = [];

  const allNums = Array.from({length: 99},(_,i)=>i+1);
  const remainingNumbers = allNums.sort(() => Math.random() - 0.5);

  let currentIndex = 0;

  function showNextNumber() {
    if (!isGameActive) {
      clearTimeout(clickConfirmTimer);
      return;
    }

    // Ø§Ú¯Ø± Ù‡Ù…Ù‡ Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ù†Ø¯ÙˆÙ… ØªÙ…Ø§Ù… Ø´Ø¯
    if (currentIndex >= remainingNumbers.length) {
      randomBox.textContent = "Ù¾Ø§ÛŒØ§Ù† ğŸ¯";
      clearTimeout(clickConfirmTimer);
      if (!checkWinCondition()) {
        handleLoss("ğŸ˜” Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ù†Ø¯ÙˆÙ… ØªÙ…Ø§Ù… Ø´Ø¯ Ùˆ Ø´Ù…Ø§ Ù†ØªÙˆØ§Ù†Ø³ØªÛŒØ¯ Ù‡Ù…Ù‡ 9 Ø¹Ø¯Ø¯ Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯.");
      }
      return;
    }

    const num = remainingNumbers[currentIndex];
    randomBox.textContent = num;
    readNumbers.push(num);

    currentNumberToConfirm = null;
    clickConfirmed = false;
    clearTimeout(clickConfirmTimer);

    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ø¹Ø¯Ø¯ Ø¯Ø± Ù…ÛŒØ§Ù† 9 Ø¯Ú©Ù…Ù‡ Ø§Ø³Øª
    if (buttonNumbers.includes(num)) {
      currentNumberToConfirm = num;
      clickConfirmed = false;

      // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…Ø± 10 Ø«Ø§Ù†ÛŒÙ‡ Ø§ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒÚ©
      clickConfirmTimer = setTimeout(() => {
        if (!clickConfirmed) {
          handleLoss(`â›” Ø¨Ø¹Ù„Øª Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù† Ø´Ù…Ø§Ø±Ù‡ ${num} Ø¯Ø± Ø·ÙˆÙ„ 10 Ø«Ø§Ù†ÛŒÙ‡ØŒ Ø´Ù…Ø§ Ø¨Ø§Ø®ØªÛŒØ¯.`);
        }
      }, 10000);
    }

    currentIndex++;

    // ØªØ§ÛŒÙ…Ø± 4 Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¹Ø¯Ø¯ Ø¨Ø¹Ø¯ÛŒ
    setTimeout(showNextNumber, 4000);
  }

  showNextNumber();
}

function handleButtonClick(btn, num) {
  if (btn.classList.contains("selected")) return;
  if (!isGameActive) return;

  if (readNumbers.includes(num)) {
    btn.classList.add("selected");
    // Ø§Ú¯Ø± Ø¹Ø¯Ø¯ÛŒ Ú©Ù‡ Ú©Ù„ÛŒÚ© Ø´Ø¯ØŒ Ù‡Ù…Ø§Ù† Ø¹Ø¯Ø¯ ØªØ§ÛŒÙ…Ø± Ø¯Ø§Ø± Ø¨ÙˆØ¯
    if (num === currentNumberToConfirm) {
      clickConfirmed = true;
      clearTimeout(clickConfirmTimer); 
      currentNumberToConfirm = null;
    }
    checkWinCondition();
  } else {
    btn.style.borderColor = "#ff4444";
    setTimeout(() => (btn.style.borderColor = "#78cf31"), 400);
  }
}

document.getElementById("cancelBtn").addEventListener("click", () => {
  if (isGameActive && isCountdownOver) {
    if (confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¨Ø§ Ø§Ù†ØµØ±Ø§Ù ${CANCEL_PENALTY} Ø³Ú©Ù‡ Ø¬Ø±ÛŒÙ…Ù‡ Ø¨Ù„ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯.`)) {
      updateBalance(-CANCEL_PENALTY);
      alert(`âš ï¸ Ø§Ù†ØµØ±Ø§Ù Ù¾Ø³ Ø§Ø² Ø´Ø±ÙˆØ¹ Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒ! ${CANCEL_PENALTY} Ø³Ú©Ù‡ Ø¬Ø±ÛŒÙ…Ù‡ Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø³Ø± Ø´Ø¯.`);
    } else {
      return;
    }
  }
  resetGameToMenu();
});


// Initial Load
document.addEventListener('DOMContentLoaded', () => {
  loadBalance();
  showMenu();
});
  </script>
</body>
</html>

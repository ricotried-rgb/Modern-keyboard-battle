<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨Ø§Ø²ÛŒ Ø§Ù…ÛŒØ± ğŸ‘‘</title>
  <style>
/* 
ØªÙˆØ¬Ù‡: ÙØ±Ø¶ Ø´Ø¯Ù‡ ÙÙˆÙ†Øª 'b titr' Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ú©Ø§Ø±Ø¨Ø± Ù†ØµØ¨ Ø§Ø³Øª. 
Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù„ÛŒÙ†Ú© Ø®Ø§Ø±Ø¬ÛŒ ÛŒØ§ @font-face Ú©Ø§Ù…Ù„ Ø¨ÙˆØ¯ØŒ Ø¨Ø§ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯.
*/
body {
background-color: #4e0101;
color: #fff;
font-family: 'b titr', Tahoma, sans-serif;
display: flex;
justify-content: center;
align-items: center;
height: 100vh;
margin: 0;
flex-direction: column;
overflow-y: auto; /* Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø¨Ù„Ù†Ø¯ */
}

#menu {
display: flex;
flex-direction: column;
align-items: center;
gap: 15px;
}

button {
width: 120px;
height: 45px;
background-color: #000;
color: #fff;
border: 2px solid #78cf31;
border-radius: 10px;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
cursor: pointer;
transition: 0.3s;
}

button:hover {
background-color: #78cf31;
color: #000;
}

#countdown {
font-size: 50px;
font-weight: bold;
margin-bottom: 20px;
display: none;
}

#gameArea {
display: none;
flex-direction: column;
align-items: center;
gap: 25px;
}

#buttonGrid {
display: grid;
grid-template-columns: repeat(5, 120px);
grid-template-rows: repeat(3, 45px);
gap: 15px;
justify-content: center;
align-content: center;
}

#randomBox {
width: 150px;
height: 150px;
border: 4px solid #78cf31;
border-radius: 15px;
display: flex;
justify-content: center;
align-items: center;
font-size: 48px;
color: #78cf31;
font-family: 'b titr', Tahoma, sans-serif;
display: none;
}

.selected {
background-color: #78cf31;
color: #000;
}

#cancelBtn {
width: 130px;
height: 45px;
background-color: #a10000;
color: #fff;
border: 2px solid #fff;
border-radius: 10px;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
cursor: pointer;
margin-top: 15px;
}

#cancelBtn:hover {
background-color: #ff4444;
color: #000;
}

/* ------------------------------ Modal Styles ------------------------------ */

#settingsPage, #walletPage, #shopPage, #adminPage, #contactPage { /* Ø´Ø§Ù…Ù„ ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯ */
display: none;
flex-direction: column;
align-items: center;
max-width: 90%;
min-width: 350px;
text-align: center;
gap: 15px;
background-color: rgba(0,0,0,0.4);
border-radius: 15px;
padding: 20px;
max-height: 90vh; /* Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¯Ø± Ú¯Ø²Ø§Ø±Ø´Ø§Øª */
overflow-y: auto;
}

/* ğŸ“ ØµÙØ­Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª - Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ */
#contactPage {
border: 2px solid #fff; 
}
#contactPage button {
width: 250px; /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ø±ÛŒØ¶â€ŒØªØ± Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª */
}


/* âš™ï¸ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
#settingsPage {
border: 2px solid #78cf31;
}
#settingsPage input {
width: 90%;
height: 35px;
border: 2px solid #78cf31;
border-radius: 10px;
text-align: center;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
outline: none;
color: #000;
}

#settingsInfo {
font-size: 13px;
color: #ffdb99;
direction: rtl;
text-align: justify;
}

#saveSettings {
width: 100px;
height: 40px;
background-color: #007a00;
border: 2px solid #78cf31;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#saveSettings:hover {
background-color: #78cf31;
color: #000;
}

/* ğŸ’° ØµÙØ­Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ */
#walletPage {
border: 2px solid #ffdb99;
}
#balanceBox {
width: 250px;
height: 60px;
border: 2px dashed #ffdb99;
border-radius: 10px;
display: flex;
justify-content: center;
align-items: center;
font-size: 20px;
color: #ffdb99;
margin-bottom: 10px;
}

#walletPage input {
width: 90%;
height: 35px;
border: 2px solid #ffdb99;
border-radius: 10px;
text-align: center;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
outline: none;
color: #000;
margin-top: 10px;
}

#sellPrice {
font-size: 14px;
color: #78cf31;
}

#totalRialsDisplay {
font-size: 18px;
color: #fff;
font-weight: bold;
}

#sellBtn {
width: 100px;
height: 40px;
background-color: #a10000;
border: 2px solid #fff;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#sellBtn:hover {
background-color: #ff4444;
color: #000;
}

#backBtn, #walletBackBtn, #shopBackBtn, #adminBackBtn, #contactBackBtn { /* Ø´Ø§Ù…Ù„ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¬Ø¯ÛŒØ¯ */
width: 100px;
height: 40px;
background-color: #950000;
border: 2px solid #fff;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#backBtn:hover, #walletBackBtn:hover, #shopBackBtn:hover, #adminBackBtn:hover, #contactBackBtn:hover {
background-color: #ff4444;
color: #000;
}

/* ğŸ›ï¸ ØµÙØ­Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ */
#shopPage {
border: 2px solid #78cf31;
color: #fff;
}

#shopPage input {
border: 2px solid #78cf31;
}

#buyPrice {
font-size: 14px;
color: #78cf31;
}

#totalBuyPriceDisplay {
font-size: 18px;
font-weight: bold;
color: #fff;
}

#buyBtn {
width: 100px;
height: 40px;
background-color: #007a00;
border: 2px solid #78cf31;
border-radius: 10px;
color: #fff;
cursor: pointer;
}

#buyBtn:hover {
background-color: #78cf31;
color: #000;
}

/* ğŸ‘‘ ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª - Ø¬Ø¯ÙˆÙ„ Ú¯Ø²Ø§Ø±Ø´Ø§Øª */
#adminPage {
border: 2px solid #fff;
}

#adminPassword {
width: 90%;
height: 35px;
border: 2px solid #fff; 
border-radius: 10px;
text-align: center;
font-family: 'b titr', Tahoma, sans-serif;
font-size: 16px;
outline: none;
color: #000;
margin-top: 10px;
}

#adminLoginBtn {
width: 100px;
height: 40px;
background-color: #007a00;
border: 2px solid #78cf31;
border-radius: 10px;
color: #fff;
cursor: pointer;
margin-top: 15px;
}

#reportArea {
width: 100%;
margin-top: 20px;
direction: rtl;
overflow-x: auto;
}

#reportArea h4 {
color: #ffdb99;
margin-bottom: 10px;
}

.report-table {
width: 100%;
border-collapse: collapse;
min-width: 800px; /* Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙØ´Ø±Ø¯Ù‡ Ø´Ø¯Ù† Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ */
font-size: 14px;
}

.report-table th, .report-table td {
border: 1px solid #78cf31;
padding: 8px;
text-align: right;
vertical-align: middle;
}

.report-table th {
background-color: rgba(120, 207, 49, 0.2);
color: #fff;
}

.report-table td button {
width: 100px;
height: 35px;
font-size: 13px;
transition: none;
}

/* Ø¯Ú©Ù…Ù‡ ØªØ³ÙˆÛŒÙ‡ (Sell Report) */
.settle-btn {
background-color: #a10000; 
border: 1px solid #fff;
}
.settled {
background-color: #007a00;
border: 1px solid #78cf31;
cursor: default;
}

/* Ø¯Ú©Ù…Ù‡ Ø±ÙˆÛŒØª Ø´Ø¯ (Buy Report) */
.review-btn {
background-color: #ffdb99; 
color: #000;
border: 1px solid #000;
}
.reviewed {
background-color: #007a00;
border: 1px solid #78cf31;
color: #fff;
cursor: default;
}

  </style>
</head>

<body>
  <!-- ğŸ® Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
  <div id="menu">
<button id="startBtn">ğŸ® Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
<button id="settings">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
<button id="wallet">ğŸ’° Ú©ÛŒÙ Ù¾ÙˆÙ„</button>
<button id="shopBtn">ğŸ›ï¸ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</button>
<button id="contactBtn">ğŸ“ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª</button> 
<button id="admin">ğŸ‘‘ Ù…Ø¯ÛŒØ±ÛŒØª</button>
  </div>

  <div id="countdown"></div>

  <!-- ğŸ² Ø¨Ø§Ø²ÛŒ -->
  <div id="gameArea">
<div id="buttonGrid"></div>
<div id="randomBox"></div>
<button id="cancelBtn">âŒ Ø§Ù†ØµØ±Ø§Ù</button>
  </div>

  <!-- âš™ï¸ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
  <div id="settingsPage">
<h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ø±Ø¨Ø± ğŸ’¾</h3>
<input type="text" id="fullname" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" />

<p id="settingsInfo">
âš ï¸ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ú©Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ù‚Ø³Ù…Øª ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ Ø´Ù…Ø§ Ù‡Ù…Ø®ÙˆØ§Ù†ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.
Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø¬Ù‡Øª ÙˆØ§Ø±ÛŒØ² Ù‡Ø¯ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø³Øª Ùˆ Ø¯Ø±ØµÙˆØ±Øª Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§ØªØŒ Ø§Ø¯Ù…ÛŒÙ† Ù…Ø³Ø¦ÙˆÙ„ÛŒØªÛŒ Ø¯Ø± Ù‚Ø¨Ø§Ù„ Ø®Ø·Ø§ÛŒ Ø´Ù…Ø§ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø¯Ø§Ø´Øª.
</p>

<input type="text" id="cardNumber" maxlength="16" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª 16 Ø±Ù‚Ù…ÛŒ" />

<button id="saveSettings">ØªØ£ÛŒÛŒØ¯ âœ…</button>
<button id="backBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>
  
  <!-- ğŸ’° ØµÙØ­Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ -->
  <div id="walletPage">
<h3>Ú©ÛŒÙ Ù¾ÙˆÙ„ ğŸ’°</h3>

<div id="balanceBox">
Ù…ÙˆØ¬ÙˆØ¯ÛŒ: <span id="currentBalance">10</span> Ø³Ú©Ù‡
</div>

<input type="number" id="sellAmount" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´" min="1" />
<p id="sellPrice">Ù‚ÛŒÙ…Øª Ù‡Ø± 1 Ø³Ú©Ù‡: 1000 ØªÙˆÙ…Ø§Ù†</p>
<span id="totalRialsDisplay"></span>

<button id="sellBtn">ÙØ±ÙˆØ´ ğŸ’¸</button>
<button id="walletBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>

  <!-- ğŸ›ï¸ ØµÙØ­Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
  <div id="shopPage">
<h3>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ğŸ›ï¸</h3>
<input type="number" id="buyAmount" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯" min="1" />
<p id="buyPrice">Ù‚ÛŒÙ…Øª Ù‡Ø± 1 Ø³Ú©Ù‡: 1200 ØªÙˆÙ…Ø§Ù†</p>
<span id="totalBuyPriceDisplay"></span>
<button id="buyBtn">Ø®Ø±ÛŒØ¯ ğŸ›’</button>
<button id="shopBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>
  
  <!-- ğŸ‘‘ ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª - Ø¬Ø¯ÛŒØ¯ -->
  <div id="adminPage">
<h3 id="adminTitle">ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª ğŸ”’</h3>

<div id="adminLoginForm" style="display: flex; flex-direction: column; align-items: center; width: 100%;">
<input type="password" id="adminPassword" maxlength="4" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Û´ Ø±Ù‚Ù…ÛŒ" />
<button id="adminLoginBtn">ÙˆØ±ÙˆØ¯ âœ…</button>
<p id="adminAuthMessage" style="color: red; font-size: 14px; margin: 5px 0;"></p>
</div>

<div id="adminContent" style="display:none; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px; width: 100%;">
<p style="color: #78cf31; font-size: 18px;">Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ Ø§Ù…ÛŒØ± ğŸ‘‘!</p>

<!-- Ø¯Ú©Ù…Ù‡ Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ -->
<button id="buyReportBtn" style="width: 200px; background-color: #007a00; border-color: #78cf31;">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡</button>
<button id="sellReportBtn" style="width: 200px; background-color: #a10000; border-color: #fff;">ğŸ“‰ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ Ø³Ú©Ù‡</button>
<!-- Ù¾Ø§ÛŒØ§Ù† Ø¯Ú©Ù…Ù‡ Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ -->

<!-- Ù†Ø§Ø­ÛŒÙ‡ Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
<div id="reportArea">
<!-- Ø¬Ø¯Ø§ÙˆÙ„ Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
</div>

</div>

<button id="adminBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>

  <!-- ğŸ“ ØµÙØ­Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª - Ø¬Ø¯ÛŒØ¯ -->
  <div id="contactPage">
<h3>ğŸ“ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª</h3>
<button id="buySellContactBtn">Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´ Ø³Ú©Ù‡</button>
<button id="channelContactBtn">Ú©Ø§Ù†Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹ Ø±Ø³Ø§Ù†ÛŒ</button>
<button id="contactBackBtn">Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™</button>
  </div>

  <script>
// --- CONSTANTS ---
const GAME_COST = 1;
const WIN_REWARD = 10;
const LOSS_PENALTY = 5;
const CANCEL_PENALTY = 2; // Ø¬Ø±ÛŒÙ…Ù‡ Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ Ø§Ø² Ø´Ø±ÙˆØ¹
const SELL_PRICE = 1000;
const BUY_PRICE = 1200; // Ù†Ø±Ø® Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡
const ADMIN_PASS = "1428"; // Ø±Ù…Ø² Ù…Ø¯ÛŒØ±ÛŒØª

// Ø¹Ù†Ø§ØµØ± ØµÙØ­Ù‡
const settings = document.getElementById("settings");
const settingsPage = document.getElementById("settingsPage");
const backBtn = document.getElementById("backBtn");
const saveSettingsBtn = document.getElementById("saveSettings");
const fullnameInput = document.getElementById("fullname");
const cardNumberInput = document.getElementById("cardNumber");

const walletBtn = document.getElementById("wallet");
const walletPage = document.getElementById("walletPage");
const walletBackBtn = document.getElementById("walletBackBtn");
const currentBalanceSpan = document.getElementById("currentBalance");
const sellAmountInput = document.getElementById("sellAmount");
const sellBtn = document.getElementById("sellBtn");
const totalRialsDisplay = document.getElementById("totalRialsDisplay");

const shopBtn = document.getElementById("shopBtn");
const shopPage = document.getElementById("shopPage");
const buyAmountInput = document.getElementById("buyAmount");
const buyBtn = document.getElementById("buyBtn");
const totalBuyPriceDisplay = document.getElementById("totalBuyPriceDisplay");
const shopBackBtn = document.getElementById("shopBackBtn");

const startBtn = document.getElementById("startBtn");
const menu = document.getElementById("menu");
const countdown = document.getElementById("countdown");
const gameArea = document.getElementById("gameArea");
const buttonGrid = document.getElementById("buttonGrid");
const randomBox = document.getElementById("randomBox");
const cancelBtn = document.getElementById("cancelBtn");

// âœ… Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
const contactBtn = document.getElementById("contactBtn"); 
const contactPage = document.getElementById("contactPage"); // Ø¹Ù†ØµØ± ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯
const buySellContactBtn = document.getElementById("buySellContactBtn"); // Ø¯Ú©Ù…Ù‡ Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´
const channelContactBtn = document.getElementById("channelContactBtn"); // Ø¯Ú©Ù…Ù‡ Ú©Ø§Ù†Ø§Ù„
const contactBackBtn = document.getElementById("contactBackBtn"); // Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª

// Ø¹Ù†Ø§ØµØ± Ù…Ø¯ÛŒØ±ÛŒØª Ø¬Ø¯ÛŒØ¯
const adminBtn = document.getElementById("admin");
const adminPage = document.getElementById("adminPage");
const adminPasswordInput = document.getElementById("adminPassword");
const adminLoginBtn = document.getElementById("adminLoginBtn");
const adminAuthMessage = document.getElementById("adminAuthMessage");
const adminContent = document.getElementById("adminContent");
const adminLoginForm = document.getElementById("adminLoginForm");
const adminBackBtn = document.getElementById("adminBackBtn");
const reportArea = document.getElementById("reportArea"); // Ù†Ø§Ø­ÛŒÙ‡ Ø¬Ø¯ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´Ø§Øª
// Ø¯Ú©Ù…Ù‡ Ù‡Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯
const buyReportBtn = document.getElementById("buyReportBtn");
const sellReportBtn = document.getElementById("sellReportBtn");


let randomInterval;
let readNumbers = [];
let buttonNumbers = [];
let isGameActive = false;
let isCountdownOver = false;

// ØªØ§ÛŒÙ…Ø± 10 Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¹Ø¯Ø¯ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡
let clickConfirmTimer = null;
let currentNumberToConfirm = null;
let clickConfirmed = false;

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ø§Øª ---
function hideAllPages() {
settingsPage.style.display = "none";
walletPage.style.display = "none";
shopPage.style.display = "none";
adminPage.style.display = "none";
contactPage.style.display = "none"; // âœ… ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
gameArea.style.display = "none";
menu.style.display = "none";
reportArea.innerHTML = ""; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù‡Ù†Ú¯Ø§Ù… ØªØºÛŒÛŒØ± ØµÙØ­Ù‡
}

function showMenu() {
hideAllPages();
menu.style.display = "flex";
}

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³Ú©Ù‡ ---
function loadBalance() {
let balance = localStorage.getItem("userBalance");
if (balance === null || isNaN(parseInt(balance))) {
balance = 10;
localStorage.setItem("userBalance", balance);
}
currentBalanceSpan.textContent = parseInt(balance);
return parseInt(balance);
}

function updateBalance(amount) {
const current = loadBalance();
const newBalance = current + amount;
localStorage.setItem("userBalance", newBalance);
currentBalanceSpan.textContent = newBalance;
return newBalance;
}

// Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ
function resetGameToMenu() {
clearInterval(randomInterval);
clearTimeout(clickConfirmTimer);

buttonGrid.innerHTML = "";

readNumbers = [];
buttonNumbers = [];
isGameActive = false;
isCountdownOver = false;
currentNumberToConfirm = null;
clickConfirmed = false;

gameArea.style.display = "none";
randomBox.style.display = "none";
countdown.style.display = "none";
showMenu();
}

// Ù…Ù†Ø·Ù‚ Ø¨Ø§Ø®Øª Ùˆ Ø¨Ø±Ø¯
function handleWin() {
updateBalance(WIN_REWARD);
alert(`ğŸ‰ ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÛŒÙ… Ø§Ù…ÛŒØ±! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯ Ùˆ ${WIN_REWARD} Ø³Ú©Ù‡ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`);
resetGameToMenu();
}

function handleLoss(message) {
updateBalance(-LOSS_PENALTY);
alert(message || `ğŸ˜” Ù…ØªØ£Ø³ÙÛŒÙ… Ø§Ù…ÛŒØ±! Ø´Ù…Ø§ Ø¨Ø§Ø®ØªÛŒØ¯ Ùˆ ${LOSS_PENALTY} Ø³Ú©Ù‡ Ø§Ø² Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ú©Ø³Ø± Ø´Ø¯.`);
resetGameToMenu();
}

function checkWinCondition() {
const buttons = buttonGrid.querySelectorAll("button");
let selectedCount = 0;
buttons.forEach(btn => {
if (btn.classList.contains("selected")) {
selectedCount++;
}
});
if (selectedCount === 15) {
clearInterval(randomInterval);
clearTimeout(clickConfirmTimer); 
handleWin();
return true;
}
return false;
}

// --- Ú¯Ø²Ø§Ø±Ø´Ø§Øª ---

function getCurrentDateTime() {
const now = new Date();
const date = now.toLocaleDateString('fa-IR');
const time = now.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
return `${date} Ø³Ø§Ø¹Øª ${time}`;
}

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ ---
function loadSellReports() {
return JSON.parse(localStorage.getItem("sellReports") || "[]");
}

function saveSellReports(reports) {
localStorage.setItem("sellReports", JSON.stringify(reports));
}

function renderSellReports() {
const reports = loadSellReports();
reportArea.innerHTML = '<h4>ğŸ“‰ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ ÙØ±ÙˆØ´ Ø³Ú©Ù‡</h4>';

if (reports.length === 0) {
reportArea.innerHTML += '<p style="color:#ffdb99;">Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
return;
}

let tableHTML = '<table class="report-table"><thead><tr>';
tableHTML += '<th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>';
tableHTML += '<th>Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª (Ú©Ø§Ù…Ù„)</th>';
tableHTML += '<th>Ø³Ú©Ù‡ ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯Ù‡</th>';
tableHTML += '<th>Ù…Ø¨Ù„Øº ÙˆØ§Ø±ÛŒØ²ÛŒ (ØªÙˆÙ…Ø§Ù†)</th>';
tableHTML += '<th>ØªØ§Ø±ÛŒØ®/Ø³Ø§Ø¹Øª</th>';
tableHTML += '<th>ÙˆØ¶Ø¹ÛŒØª</th>';
tableHTML += '</tr></thead><tbody>';

reports.forEach((report, index) => {
const settledClass = report.settled ? 'settled' : 'settle-btn';
const buttonText = report.settled ? 'âœ”ï¸ ØªØ³ÙˆÛŒÙ‡ Ø´Ø¯' : 'ğŸ’µ ØªØ³ÙˆÛŒÙ‡ Ú©Ù†';
const disabled = report.settled ? 'disabled' : '';

tableHTML += `<tr>`;
tableHTML += `<td>${report.fullName}</td>`;
tableHTML += `<td>${report.cardNumber}</td>`;
tableHTML += `<td>${report.coinsSold}</td>`;
tableHTML += `<td>${report.totalRials.toLocaleString('fa-IR')}</td>`;
tableHTML += `<td>${report.dateTime}</td>`;
tableHTML += `<td><button id="settle-${index}" class="${settledClass}" ${disabled}>${buttonText}</button></td>`;
tableHTML += `</tr>`;
});

tableHTML += '</tbody></table>';
reportArea.innerHTML += tableHTML;

// Ø§ÙØ²ÙˆØ¯Ù† Ø´Ù†ÙˆÙ†Ø¯Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³ÙˆÛŒÙ‡
reports.forEach((report, index) => {
const btn = document.getElementById(`settle-${index}`);
if (btn && !report.settled) {
btn.addEventListener('click', () => handleSettle(index));
}
});
}

function handleSettle(index) {
let reports = loadSellReports();
if (reports[index] && !reports[index].settled) {
reports[index].settled = true;
saveSellReports(reports);

// Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ø¯Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡
renderSellReports();
}
}

// --- Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯ ---
function loadBuyReports() {
return JSON.parse(localStorage.getItem("buyReports") || "[]");
}

function saveBuyReports(reports) {
localStorage.setItem("buyReports", JSON.stringify(reports));
}

function renderBuyReports() {
const reports = loadBuyReports();
reportArea.innerHTML = '<h4>ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡</h4>';

if (reports.length === 0) {
reportArea.innerHTML += '<p style="color:#ffdb99;">Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
return;
}

let tableHTML = '<table class="report-table"><thead><tr>';
tableHTML += '<th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>';
tableHTML += '<th>ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ø®Ø±ÛŒØ¯Ù‡ Ø´Ø¯Ù‡</th>';
tableHTML += '<th>Ù…Ø¨Ù„Øº ÙˆØ§Ø±ÛŒØ²ÛŒ (ØªÙˆÙ…Ø§Ù†)</th>';
tableHTML += '<th>ØªØ§Ø±ÛŒØ®/Ø³Ø§Ø¹Øª</th>';
tableHTML += '<th>ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª</th>';
tableHTML += '</tr></thead><tbody>';

reports.forEach((report, index) => {
const reviewedClass = report.reviewed ? 'reviewed' : 'review-btn';
const buttonText = report.reviewed ? 'âœ”ï¸ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯' : 'âœ… Ø±ÙˆÛŒØª Ø´Ø¯';
const disabled = report.reviewed ? 'disabled' : '';

tableHTML += `<tr>`;
tableHTML += `<td>${report.fullName}</td>`;
tableHTML += `<td>${report.coinsBought}</td>`;
tableHTML += `<td>${report.totalRials.toLocaleString('fa-IR')}</td>`;
tableHTML += `<td>${report.dateTime}</td>`;
tableHTML += `<td><button id="review-${index}" class="${reviewedClass}" ${disabled}>${buttonText}</button></td>`;
tableHTML += `</tr>`;
});

tableHTML += '</tbody></table>';
reportArea.innerHTML += tableHTML;

// Ø§ÙØ²ÙˆØ¯Ù† Ø´Ù†ÙˆÙ†Ø¯Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØª Ø´Ø¯
reports.forEach((report, index) => {
const btn = document.getElementById(`review-${index}`);
if (btn && !report.reviewed) {
btn.addEventListener('click', () => handleReview(index));
}
});
}

function handleReview(index) {
let reports = loadBuyReports();
if (reports[index] && !reports[index].reviewed) {
reports[index].reviewed = true;
saveBuyReports(reports);

// Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ø¯Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡
renderBuyReports();
}
}


// --- Ú©ÛŒÙ Ù¾ÙˆÙ„ (Wallet) - Ø§Ø¯ØºØ§Ù… Ø¨Ø§ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ ---
walletBtn.addEventListener("click", () => {
hideAllPages();
walletPage.style.display = "flex";
loadBalance();
sellAmountInput.value = "";
totalRialsDisplay.textContent = "";
});

walletBackBtn.addEventListener("click", showMenu);

sellAmountInput.addEventListener("input", () => {
const sellAmount = parseInt(sellAmountInput.value);
if (isNaN(sellAmount) || sellAmount <= 0) {
totalRialsDisplay.textContent = "";
return;
}
const totalRials = sellAmount * SELL_PRICE; // 1000 ØªÙˆÙ…Ø§Ù†
totalRialsDisplay.textContent = `Ù…Ø¨Ù„Øº Ú©Ù„: ${totalRials.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
});

sellBtn.addEventListener("click", () => {
const balance = loadBalance();
const sellAmount = parseInt(sellAmountInput.value);
const cardNum = localStorage.getItem("cardNumber");
const fullName = localStorage.getItem("fullname");

if (!cardNum || !fullName) {
alert("âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ù†Ø§Ù… Ùˆ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù‚Ø³Ù…Øª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯!");
return;
}

if (isNaN(sellAmount) || sellAmount <= 0) {
alert("âš ï¸ Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
return;
}

if (sellAmount > balance) {
alert(`â›” Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: ${balance} Ø³Ú©Ù‡.`);
return;
}

const totalRials = sellAmount * SELL_PRICE;

// 1. Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´
const reports = loadSellReports();
reports.push({
fullName: fullName,
cardNumber: cardNum,
coinsSold: sellAmount,
totalRials: totalRials,
dateTime: getCurrentDateTime(),
settled: false // ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ØªØ³ÙˆÛŒÙ‡ Ù†Ø´Ø¯Ù‡
});
saveSellReports(reports);

// 2. Ú©Ø³Ø± Ø³Ú©Ù‡ Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
updateBalance(-sellAmount);

sellAmountInput.value = "";
totalRialsDisplay.textContent = "";

alert(`âœ… ${sellAmount} Ø³Ú©Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯. Ù…Ø¨Ù„Øº ${totalRials.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ø§Ø±Øª ${cardNum} Ø´Ù…Ø§ ÙˆØ§Ø±ÛŒØ² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`);
});

// --- ÙØ±ÙˆØ´Ú¯Ø§Ù‡ (Shop) - Ø§Ø¯ØºØ§Ù… Ø¨Ø§ Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯ ---
shopBtn.addEventListener("click", () => {
hideAllPages();
shopPage.style.display = "flex";
buyAmountInput.value = "";
totalBuyPriceDisplay.textContent = "";
});

shopBackBtn.addEventListener("click", showMenu);

buyAmountInput.addEventListener("input", () => {
const buyAmount = parseInt(buyAmountInput.value);
if (isNaN(buyAmount) || buyAmount <= 0) {
totalBuyPriceDisplay.textContent = "";
return;
}
const totalPrice = buyAmount * BUY_PRICE; // 1200 ØªÙˆÙ…Ø§Ù†
totalBuyPriceDisplay.textContent = `Ù…Ø¨Ù„Øº Ú©Ù„: ${totalPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
});

buyBtn.addEventListener("click", () => {
const buyAmount = parseInt(buyAmountInput.value);
const fullName = localStorage.getItem("fullname");

if (!fullName) {
alert("âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù‚Ø³Ù…Øª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯!");
return;
}

if (isNaN(buyAmount) || buyAmount <= 0) {
alert("âš ï¸ Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡ Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
return;
}

const totalPrice = buyAmount * BUY_PRICE;

// 1. Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ø®Ø±ÛŒØ¯
const reports = loadBuyReports();
reports.push({
fullName: fullName,
coinsBought: buyAmount,
totalRials: totalPrice,
dateTime: getCurrentDateTime(),
reviewed: false // ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ø±ÙˆÛŒØª Ù†Ø´Ø¯Ù‡
});
saveBuyReports(reports);

// 2. Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± (ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù‡ Ø§Ø³Øª)
updateBalance(buyAmount);

buyAmountInput.value = "";
totalBuyPriceDisplay.textContent = "";

alert(`âœ… ${buyAmount} Ø³Ú©Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ù„Øº ${totalPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯.`);
});

// --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª (Settings) ---
settings.addEventListener("click", () => {
hideAllPages();
settingsPage.style.display = "flex";

const savedName = localStorage.getItem("fullname");
const savedCard = localStorage.getItem("cardNumber");
if (savedName) fullnameInput.value = savedName;
if (savedCard) cardNumberInput.value = savedCard;
});

backBtn.addEventListener("click", showMenu);

saveSettingsBtn.addEventListener("click", () => {
const name = fullnameInput.value.trim();
const card = cardNumberInput.value.trim();

if (!name) {
alert("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
return;
}
if (!card || !/^\d{16}$/.test(card)) {
alert("âš ï¸ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø¨Ø§ÛŒØ¯ Û±Û¶ Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯.");
return;
}

localStorage.setItem("fullname", name);
localStorage.setItem("cardNumber", card);
alert("âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
});

// --- Ù…Ø¯ÛŒØ±ÛŒØª (Admin) ---
adminBtn.addEventListener("click", () => {
hideAllPages();
adminPage.style.display = "flex";

// Reset view to login form
document.getElementById("adminTitle").textContent = "ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª ğŸ”’";
adminPasswordInput.value = '';
adminAuthMessage.textContent = '';
adminContent.style.display = 'none';
adminLoginForm.style.display = 'flex';
reportArea.innerHTML = ""; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯Ø²Ø§Ø±Ø´ Ù‚Ø¨Ù„ÛŒ
});

adminLoginBtn.addEventListener("click", () => {
const password = adminPasswordInput.value;
if (password === ADMIN_PASS) {
adminAuthMessage.textContent = 'Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¬Ø§Ø²';
adminAuthMessage.style.color = 'green';
adminLoginForm.style.display = 'none';
adminContent.style.display = 'flex'; // ØªØºÛŒÛŒØ± Ø¨Ù‡ Flex Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Ù‡Ø§ÛŒ Ø³ØªÙˆÙ†ÛŒ
document.getElementById("adminTitle").textContent = "Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ğŸ‘‘";
reportArea.innerHTML = ""; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯Ø²Ø§Ø±Ø´ Ù‚Ø¨Ù„ÛŒ
} else {
adminAuthMessage.textContent = 'Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ± Ù…Ø¬Ø§Ø²';
adminAuthMessage.style.color = 'red';
}
});

adminBackBtn.addEventListener("click", showMenu);

// --- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ú¯Ø²Ø§Ø±Ø´Ø§Øª ---
buyReportBtn.addEventListener("click", renderBuyReports);
sellReportBtn.addEventListener("click", renderSellReports);

// âœ… Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
contactBtn.addEventListener("click", () => {
hideAllPages();
contactPage.style.display = "flex"; // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
});

// âœ… Ù…Ù†Ø·Ù‚ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ ØµÙØ­Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª (ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ…)
buySellContactBtn.addEventListener("click", () => {
// ØªØºÛŒÛŒØ± Ø¬Ø¯ÛŒØ¯: Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´
window.open("https://rubika.ir/IR_VBOOK", "_blank");
});

channelContactBtn.addEventListener("click", () => {
alert("ğŸ“¢ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹ Ø±Ø³Ø§Ù†ÛŒØŒ Ù…Ù†ØªØ¸Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ Ø¨Ø§Ø´ÛŒØ¯!");
});

contactBackBtn.addEventListener("click", showMenu);


// --- Ø¨Ø§Ø²ÛŒ (Game Logic) ---
startBtn.addEventListener("click", () => {
const currentBalance = loadBalance();
if (currentBalance < GAME_COST) {
alert("âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³Ú©Ù‡ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø¨Ù„ÛŒØ· Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Û± Ø³Ú©Ù‡).");
return;
}

updateBalance(-GAME_COST); // Ú©Ø³Ø± Û± Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù„ÛŒØ·

isGameActive = true; 
isCountdownOver = false;

hideAllPages();
countdown.style.display = "block";
gameArea.style.display = "flex";
buttonGrid.innerHTML = "";
randomBox.style.display = "none";

for (let i = 0; i < 15; i++) {
const btn = document.createElement("button");
btn.textContent = "ØŸ";
btn.disabled = true; 
buttonGrid.appendChild(btn);
}

let timeLeft = 5;
countdown.textContent = timeLeft;

const countdownInterval = setInterval(() => {
timeLeft--;
countdown.textContent = timeLeft;
if (timeLeft <= 0) {
clearInterval(countdownInterval);
countdown.style.display = "none";
isCountdownOver = true; 
revealNumbers();
startRandomBox();
}
}, 1000);
});

// Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¢Ù†Ù‡Ø§
function revealNumbers() {
const allNumbers = Array.from({ length: 99 }, (_, i) => i + 1).sort(() => Math.random() - 0.5);
buttonNumbers = allNumbers.slice(0, 15);

const buttons = buttonGrid.querySelectorAll("button");
buttons.forEach((btn, index) => {
const num = buttonNumbers[index];
btn.textContent = num;
btn.dataset.value = num;
btn.disabled = false;

// Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§ ÛŒÚ© Ú©Ù¾ÛŒ Ø§Ø² Ø¢Ù† Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
const newBtn = btn.cloneNode(true);
newBtn.addEventListener("click", () => handleButtonClick(newBtn, num));
btn.replaceWith(newBtn);
});
}

// Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù† Ø¨Ø¹Ø¯ Ø§Ø² Ø´Ø±ÙˆØ¹ Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ù†Ø¯ÙˆÙ…
function startRandomBox() {
randomBox.style.display = "flex";
readNumbers = [];

const allNums = Array.from({length: 99},(_,i)=>i+1);
const remainingNumbers = allNums.sort(() => Math.random() - 0.5);

let currentIndex = 0;

function showNextNumber() {
if (!isGameActive) {
clearTimeout(clickConfirmTimer);
return;
}

if (currentIndex >= remainingNumbers.length) {
randomBox.textContent = "Ù¾Ø§ÛŒØ§Ù† ğŸ¯";
clearTimeout(clickConfirmTimer);
if (!checkWinCondition()) {
handleLoss();
}
return;
}

const num = remainingNumbers[currentIndex];
randomBox.textContent = num;
readNumbers.push(num);

currentNumberToConfirm = null;
clickConfirmed = false;
clearTimeout(clickConfirmTimer);

// Ø§Ú¯Ø± Ø¹Ø¯Ø¯ ØªÙˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨ÙˆØ¯ ØªØ§ÛŒÙ…Ø± Ùˆ Ù…Ù†Ø·Ù‚ Ø«Ø¨Øª Ú©Ù„ÛŒÚ© Ø¨Ø²Ù† ÙØ¹Ø§Ù„ Ø´ÙˆØ¯
if (buttonNumbers.includes(num)) {
currentNumberToConfirm = num;
clickConfirmed = false;

// ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…Ø± 10 Ø«Ø§Ù†ÛŒÙ‡ Ø§ÛŒ
clickConfirmTimer = setTimeout(() => {
if (!clickConfirmed) {
alert(`â›” Ø¨Ø¹Ù„Øª Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù† Ø´Ù…Ø§Ø±Ù‡ ${num} Ø´Ù…Ø§ Ø¨Ø§Ø®ØªÛŒØ¯.`);
handleLoss(`Ø¨Ø¹Ù„Øª Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù† Ø´Ù…Ø§Ø±Ù‡ ${num} Ø´Ù…Ø§ Ø¨Ø§Ø®ØªÛŒØ¯.`);
}
}, 10000);
}

// Ø¨Ù‡ Ø¹Ø¯Ø¯ Ø¨Ø¹Ø¯ÛŒ Ø¨Ø¹Ø¯ 4 Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø±ÙˆÛŒÙ…
currentIndex++;

// ØªØ§ÛŒÙ…Ø± 4 Ø«Ø§Ù†ÛŒÙ‡ ÙˆØ§Ø³Ù‡ Ø±ÙØªÙ† Ø¨Ø¹Ø¯ÛŒ
setTimeout(showNextNumber, 4000);
}

showNextNumber();
}

// Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…Ù†Ø·Ù‚ Ø«Ø¨Øª
function handleButtonClick(btn, num) {
if (btn.classList.contains("selected")) return;
if (!isGameActive) return;

if (readNumbers.includes(num)) {
btn.classList.add("selected");
if (num === currentNumberToConfirm) {
clickConfirmed = true;
clearTimeout(clickConfirmTimer); // ØªØ§ÛŒÙ…Ø± Ù„ØºÙˆ Ø´ÙˆØ¯
currentNumberToConfirm = null;
}
checkWinCondition();
} else {
btn.style.borderColor = "#ff4444";
setTimeout(() => (btn.style.borderColor = "#78cf31"), 400);
}
}

// Ø§Ù†ØµØ±Ø§Ù Ø¨Ø§ Ú©Ø³Ø± Û² Ø³Ú©Ù‡ Ø¯Ø§Ø±Ø§Ù† Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ Ø§Ø² Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ùˆ Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³ Ûµ Ø«Ø§Ù†ÛŒÙ‡
cancelBtn.addEventListener("click", () => {
if (isGameActive && isCountdownOver) {
if (confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¨Ø§ Ø§Ù†ØµØ±Ø§Ù ${CANCEL_PENALTY} Ø³Ú©Ù‡ Ø¬Ø±ÛŒÙ…Ù‡ Ø¨Ù„ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯.`)) {
updateBalance(-CANCEL_PENALTY);
alert(`âš ï¸ Ø§Ù†ØµØ±Ø§Ù Ù¾Ø³ Ø§Ø² Ø´Ø±ÙˆØ¹ Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒ! ${CANCEL_PENALTY} Ø³Ú©Ù‡ Ø¬Ø±ÛŒÙ…Ù‡ Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø³Ø± Ø´Ø¯.`);
} else {
return; // Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØµØ±Ø§Ù Ø§Ø² Ù„ØºÙˆ Ø¯Ø§Ø¯
}
}
resetGameToMenu();
});

  
// Initial Load
document.addEventListener('DOMContentLoaded', () => {
loadBalance();
showMenu();
});

</script>
</body>
</html>
